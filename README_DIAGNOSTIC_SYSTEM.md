# AI Diagnostic System - Setup Guide

## Overview

A production-ready AI-powered diagnostic and roadmap system for O Level Chemistry learning platform.

## Architecture

- **Frontend**: React (Vite)
- **Backend**: Flask (Python)
- **Database**: Supabase
- **AI**: Google Gemini API

## Setup Instructions

### 1. Backend Setup

#### Install Dependencies

```bash
cd backend
pip install -r requirements.txt
```

#### Environment Variables

Create a `.env` file in the `backend` directory:

```env
GEMINI_API_KEY=AIzaSyAMAjBPgDI0QdBGx1XTlNX4QDG142r4gNI
SUPABASE_URL=your_supabase_url_here
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key_here
FLASK_ENV=development
FLASK_DEBUG=True
```

#### Run Backend Server

```bash
cd backend
python app.py
```

Backend will run on `http://localhost:5000`

### 2. Database Setup

Run the SQL migration in Supabase Dashboard:

1. Go to **Supabase Dashboard** → **SQL Editor**
2. Run `supabase_migration_diagnostics.sql`
3. This creates:
   - `diagnostics` table
   - `diagnostic_results` table
   - `roadmaps` table
   - RLS policies

### 3. Frontend Setup

#### Environment Variables

Create a `.env` file in the root directory:

```env
VITE_API_BASE_URL=http://localhost:5000
```

#### Install Dependencies (if not already done)

```bash
npm install
```

#### Run Frontend

```bash
npm run dev
```

Frontend will run on `http://localhost:5173`

## API Endpoints

### POST /generate-diagnostic
Generate diagnostic test for a chapter.

**Request:**
```json
{
  "user_id": "uuid",
  "chapter": "Stoichiometry"
}
```

**Response:**
```json
{
  "diagnostic_id": "uuid",
  "chapter": "Stoichiometry",
  "diagnostic_test": [...],
  "total_questions": 8,
  "time_limit": 30
}
```

### POST /submit-diagnostic
Submit diagnostic test answers.

**Request:**
```json
{
  "user_id": "uuid",
  "diagnostic_id": "uuid",
  "answers": {
    "0": "A",
    "1": "B",
    ...
  }
}
```

**Response:**
```json
{
  "result_id": "uuid",
  "passed": true,
  "percentage": 87.5,
  "total_correct": 7,
  "total_questions": 8,
  "bucket_scores": {...},
  "results": [...]
}
```

### GET /dashboard
Get dashboard data.

**Query Params:**
- `user_id`: User UUID

**Response:**
```json
{
  "user_id": "uuid",
  "attempted_chapters": [...],
  "passed_chapters": [...],
  "results": [...],
  "profile": {...},
  "roadmap": {...}
}
```

### POST /generate-roadmap
Generate AI roadmap.

**Request:**
```json
{
  "user_id": "uuid"
}
```

**Response:**
```json
{
  "roadmap_id": "uuid",
  "roadmap": {
    "weekly_roadmap": [...],
    "estimated_completion": "...",
    "focus_areas": [...]
  }
}
```

## Features

### Diagnostic System
- ✅ AI-generated diagnostic tests (6-8 MCQs)
- ✅ 30-minute time limit with auto-submit
- ✅ Question categorization (Basic, Conceptual, Application)
- ✅ Automatic answer evaluation
- ✅ Pass/fail based on bucket performance
- ✅ No retry allowed

### Dashboard
- ✅ Progress rings for attempted chapters
- ✅ Test Details tab with full results
- ✅ Roadmap tab with AI-generated learning plan
- ✅ Start Journey placeholder

### Roadmap Generation
- ✅ AI-powered personalized roadmap
- ✅ Weekly breakdown
- ✅ Priority-based topics
- ✅ Focus areas identification

## Available Chapters

Currently only **Stoichiometry** is available for diagnostics.

To add more chapters:
1. Update `AVAILABLE_CHAPTERS` in `backend/app.py`
2. Ensure chapter exists in student profile `chapters` JSONB field

## Testing Flow

1. Complete onboarding
2. Go to Dashboard
3. Click "Start Diagnostic" for available chapter
4. Complete test (30 minutes, auto-submit)
5. View results in Test Details tab
6. Generate roadmap in Roadmap tab
7. View personalized learning plan

## Important Notes

- ⚠️ **No hardcoded API keys** - Use environment variables only
- ⚠️ **No fake data** - All tests generated by Gemini AI
- ⚠️ **No retry** - One attempt per chapter
- ✅ **Modular architecture** - Easy to extend
- ✅ **Production-ready** - Error handling, validation, RLS

## Troubleshooting

### Backend Issues
- Check environment variables are set correctly
- Verify Supabase credentials
- Check Gemini API key is valid
- Ensure Flask server is running on port 5000

### Frontend Issues
- Check `VITE_API_BASE_URL` is set
- Verify backend is running
- Check browser console for errors

### Database Issues
- Run SQL migration if tables don't exist
- Check RLS policies are enabled
- Verify user has proper permissions

